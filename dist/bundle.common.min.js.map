{"version":3,"file":"bundle.common.min.js","sources":["../src/carbonium.ts"],"sourcesContent":["/**!\n @preserve Carbonium 0.1\n @copyright 2020 Edwin Martin\n @license MIT\n */\n\nexport function $(arg: string, doc?: Document): CarboniumList {\n  const nodelist: NodeListOf<HTMLElement> = (doc || document).querySelectorAll(\n    arg\n  );\n  return <CarboniumList><any> new Proxy<NodeListOf<HTMLElement>>(nodelist, proxyHandler);\n}\n\n// Used by classList\nlet classListNodelist: NodeListOf<HTMLElement>;\n\nconst proxyHandler: ProxyHandler<NodeListOf<HTMLElement>> = {\n  get(target, prop) {\n    // Return iterator when asked for iterator\n    if (prop == Symbol.iterator) {\n      return function* () {\n        for (let i = 0; i < target.length; i++) {\n          yield target[i];\n        }\n      };\n    }\n\n    // Special case for classList\n    if (prop == \"classList\") {\n      classListNodelist = target;\n      const propValue = Reflect.get(document.body, prop);\n      return new Proxy(propValue, proxyHandler);\n    }\n\n    // classList.add, contains, removeâ€¦\n    if (target instanceof DOMTokenList) {\n      const propValue = Reflect.get(document.body.classList, prop);\n\n      if (typeof propValue == \"function\") {\n        return new Proxy<Function>(propValue, {\n          apply: function (target, thisArg, argumentsList) {\n            classListNodelist.forEach((el) => {\n              Reflect.apply(target, el.classList, argumentsList);\n            });\n            return new Proxy(classListNodelist, proxyHandler);\n          },\n        });\n      } else {\n        return propValue;\n      }\n    }\n\n    // Are we dealing with an Array function?\n    if (Array.prototype.hasOwnProperty(prop)) {\n      const propValue = Reflect.get(Array.prototype, prop);\n      if (typeof propValue == \"function\") {\n        return new Proxy<Function>(propValue, {\n          apply: function (target, thisArg, argumentsList) {\n            const ret = Reflect.apply(target, thisArg, argumentsList);\n            // forEach returns same array instead of undefined\n            const newTarget = typeof ret != \"undefined\" ? ret : thisArg;\n            return new Proxy(newTarget, proxyHandler);\n          },\n        });\n      }\n    }\n\n    // Get property or call function on DOM elements\n    if (target.length > 0) {\n      // Might be DOM element specific, like input.select(),\n      // so use first array element to get reference\n      if (prop in target[0]) {\n        const propValue = Reflect.get(target[0], prop);\n        if (typeof propValue == \"function\") {\n          return new Proxy(propValue, proxyDOMFunctionHandler);\n        } else {\n          return propValue;\n        }\n      }\n    } else {\n      // Empty list, targeted DOM element unknown,\n      // use document.body\n      if (prop in document.body) {\n        const propValue = Reflect.get(document.body, prop);\n        if (typeof propValue == \"function\") {\n          return new Proxy(propValue, proxyDOMFunctionHandler);\n        } else {\n          return propValue;\n        }\n      }\n    }\n\n    // Default\n    return Reflect.get(target, prop);\n  },\n\n  // DOM property is set\n  set(target, prop, value) {\n    target.forEach((el) => {\n      Reflect.set(el, prop, value);\n    });\n    return true;\n  },\n};\n\nconst proxyDOMFunctionHandler: ProxyHandler<Function> = {\n  apply: function (target, thisArg, argumentsList) {\n    // Apply on individual elements\n    for (const el of thisArg) {\n      Reflect.apply(target, el, argumentsList);\n    }\n    return thisArg;\n  },\n};\n\n// TODO: Replace HTMLInputElement with union of all possible elements\ntype CarboniumType = HTMLInputElement & Array<HTMLElement>;\n\ninterface CarboniumList extends CarboniumType {\n  concat(...items: ConcatArray<HTMLElement>[]): CarboniumList;\n  concat(...items: (HTMLElement | ConcatArray<HTMLElement>)[]): CarboniumList;\n  reverse(): CarboniumList;\n  slice(start?: number, end?: number): CarboniumList;\n  splice(start: number, deleteCount?: number): CarboniumList;\n  splice(start: number, deleteCount: number, ...items: HTMLElement[]): CarboniumList;\n  forEach(callbackfn: (value: HTMLElement, index: number, array: HTMLElement[]) => void, thisArg?: any): CarboniumList;\n  filter(callbackfn: (value: HTMLElement, index: number, array: HTMLElement[]) => boolean, thisArg?: any): CarboniumList;\n  classList: CarboniumClassList;\n  setAttribute(qualifiedName: string, value: string): CarboniumList;\n}\n\ninterface CarboniumClassList extends DOMTokenList {\n  add(...tokens: string[]): CarboniumList;\n  remove(...tokens: string[]): CarboniumList;\n  replace(oldToken: string, newToken: string): CarboniumList;\n  forEach(callbackfn: (value: string, key: number, parent: DOMTokenList) => void, thisArg?: any): CarboniumList;\n}\n"],"names":["classListNodelist","proxyHandler","[object Object]","target","prop","Symbol","iterator","i","length","propValue","Reflect","get","document","body","Proxy","DOMTokenList","classList","apply","thisArg","argumentsList","forEach","el","Array","prototype","hasOwnProperty","ret","proxyDOMFunctionHandler","set","value","arg","doc","nodelist","querySelectorAll"],"mappings":"aAcA,IAAIA,yDAEJ,MAAMC,EAAsD,CAC1DC,IAAIC,EAAQC,GAEV,GAAIA,GAAQC,OAAOC,SACjB,OAAO,YACL,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAOK,OAAQD,UAC3BJ,EAAOI,IAMnB,GAAY,aAARH,EAAqB,CACvBJ,EAAoBG,EACpB,MAAMM,EAAYC,QAAQC,IAAIC,SAASC,KAAMT,GAC7C,OAAO,IAAIU,MAAML,EAAWR,GAI9B,GAAIE,aAAkBY,aAAc,CAClC,MAAMN,EAAYC,QAAQC,IAAIC,SAASC,KAAKG,UAAWZ,GAEvD,MAAwB,mBAAbK,EACF,IAAIK,MAAgBL,EAAW,CACpCQ,MAAO,SAAUd,EAAQe,EAASC,GAIhC,OAHAnB,EAAkBoB,QAASC,IACzBX,QAAQO,MAAMd,EAAQkB,EAAGL,UAAWG,KAE/B,IAAIL,MAAMd,EAAmBC,MAIjCQ,EAKX,GAAIa,MAAMC,UAAUC,eAAepB,GAAO,CACxC,MAAMK,EAAYC,QAAQC,IAAIW,MAAMC,UAAWnB,GAC/C,GAAwB,mBAAbK,EACT,OAAO,IAAIK,MAAgBL,EAAW,CACpCQ,MAAO,SAAUd,EAAQe,EAASC,GAChC,MAAMM,EAAMf,QAAQO,MAAMd,EAAQe,EAASC,GAG3C,OAAO,IAAIL,WADqB,IAAPW,EAAqBA,EAAMP,EACxBjB,MAOpC,GAAIE,EAAOK,OAAS,GAGlB,GAAIJ,KAAQD,EAAO,GAAI,CACrB,MAAMM,EAAYC,QAAQC,IAAIR,EAAO,GAAIC,GACzC,MAAwB,mBAAbK,EACF,IAAIK,MAAML,EAAWiB,GAErBjB,QAMX,GAAIL,KAAQQ,SAASC,KAAM,CACzB,MAAMJ,EAAYC,QAAQC,IAAIC,SAASC,KAAMT,GAC7C,MAAwB,mBAAbK,EACF,IAAIK,MAAML,EAAWiB,GAErBjB,EAMb,OAAOC,QAAQC,IAAIR,EAAQC,IAI7BuB,IAAG,CAACxB,EAAQC,EAAMwB,KAChBzB,EAAOiB,QAASC,IACdX,QAAQiB,IAAIN,EAAIjB,EAAMwB,MAEjB,IAILF,EAAkD,CACtDT,MAAO,SAAUd,EAAQe,EAASC,GAEhC,IAAK,MAAME,KAAMH,EACfR,QAAQO,MAAMd,EAAQkB,EAAIF,GAE5B,OAAOD;;;;;;SAzGOW,EAAaC,GAC7B,MAAMC,GAAqCD,GAAOlB,UAAUoB,iBAC1DH,GAEF,OAA4B,IAAIf,MAA+BiB,EAAU9B"}